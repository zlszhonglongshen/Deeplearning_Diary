[Yolov3&Yolov4网络结构与源码分析,包含了详细的关于IOU解释](https://www.cnblogs.com/wujianming-110117/p/13845974.html)

Bounding Box Regeression的Loss近些年的发展过程是Smooth L1 Loss-> IoU Loss（2016）-> GIoU Loss（2019）-> DIoU Loss（2020）->CIoU Loss（2020）

**a.IOU_Loss**

![img](https://img2020.cnblogs.com/blog/1251718/202010/1251718-20201020132123813-153771893.png)

可以看到IOU的loss其实很简单，主要是**交集**/**并集**，但其实也存在两个问题。

 ![img](https://img2020.cnblogs.com/blog/1251718/202010/1251718-20201020132149539-417004304.png)

**问题1**：状态1的情况，当预选框和目标框不相交时，IOU=0，无法反应两个框距离的远近，此时损失函数不可导，IOU-LOSS无法优化两个框不想交的情况；

**问题2**：状态2和状态3的情况，当两个预测框大小相同，两个IOU也相同，IOU_LOSS无法区分两者相交的不同。

因为2019年出现了GIOU—LOSS来进行改进。

**b.GIOU_Loss**

![img](https://img2020.cnblogs.com/blog/1251718/202010/1251718-20201020132214901-1101622476.png)

可以看到右图GIOU-LOSS中，增加了相交尺寸的衡量方式，缓解了单纯IOU-loss的尴尬，但为什么仅仅说缓解呢？

因为还存在一种不足：

![img](https://img2020.cnblogs.com/blog/1251718/202010/1251718-20201020132241903-28134304.png)

**问题**：状态1、2、3都是预测框在目标框内部且预测框大小一致的情况，这时预测框和目标框的差集都是相同的，因此这三种状态的**GIOU**值**也都是相同的，这时GIOU退化成了IOU，无法区分相对位置关系。
基于这个问题，**2020**年**的AAAI又提出了**DIOU_Loss**。

**c.DIOU_Loss**

好的目标框回归函数应该考虑三个重要几何因素：**重叠面积、中心点距离，长宽比。**

针对IOU和GIOU存在的问题，作者从两个方面进行考虑

**一：如何最小化预测框和目标框之间的归一化距离？**

**二：如何在预测框和目标框重叠时，回归的更准确？**

针对第一个问题，提出了DIOU_Loss（Distance_IOU_Loss）

![img](https://img2020.cnblogs.com/blog/1251718/202010/1251718-20201020132311143-1150362627.png)

DIOU-loss考虑了**重叠面积和中心点距离**，当目标框包裹预测框的时候，直接度量2个框的距离，因此DIOU-loss收敛的更快。

但好像前面好的目标框框回归函数所说的，没有考虑长宽比。

![img](https://img2020.cnblogs.com/blog/1251718/202010/1251718-20201020132330838-1307754437.png)

比如上面三种情况，目标框包裹预测框，本来DIOU_Loss可以起作用。

但预测框的中心点的位置都是一样的，因此按照DIOU_Loss的计算公式，三者的值都是相同的。

针对这个问题，又提出了CIOU_Loss，不对不说，科学总是在解决问题中，不断进步！！

**d.CIOU_Loss**

CIOU_Loss和DIOU_Loss前面的公式都是一样的，不过在此

基础上还增加了一个影响因子，将预测框和目标框的长宽比都考虑了进去。其中v是衡量长宽比一致性的参数，我们也可以定义为：

 ![img](https://img2020.cnblogs.com/blog/1251718/202010/1251718-20201020132355201-523151490.png)

 

 

这样CIOU_Loss就将目标框回归函数应该考虑三个重要几何因素：重叠面积、中心点距离，长宽比全都考虑进去了。

再来综合的看下各个Loss函数的不同点：

**IOU_Loss**：主要考虑检测框和目标框重叠面积。

**GIOU_Loss**：在IOU的基础上，解决边界框不重合时的问题。

**DIOU_Loss**：在IOU和GIOU的基础上，考虑边界框中心点距离的信息。

**CIOU_Loss**：在DIOU的基础上，考虑边界框宽高比的尺度信息。

Yolov4中采用了**CIOU_Loss**的回归方式，使得预测框回归的**速度和精度**更高一些。